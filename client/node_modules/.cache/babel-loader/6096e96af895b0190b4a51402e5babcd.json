{"ast":null,"code":"var _jsxFileName = \"/Users/celia/Projects/Merakey/client/src/components/playGame.js\",\n    _s = $RefreshSig$();\n\nimport \"../styles/playGame.scss\";\nimport { useParams } from \"react-router-dom\";\nimport { ToastContainer, toast, Slide } from \"react-toastify\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport React, { useState } from \"react\";\nimport IsLoggedIn, { logout, getCurrentUser } from \"./utilities/loginStatus\";\nimport Confetti from \"react-confetti\";\nimport progress from \"../images/progress.png\";\nimport download from \"../images/download.svg\";\nimport downloadPDF from \"./downloadWrong\"; // import { plott } from \"./zzz/plot\";\n// import { addGame } from \"./utilities/addGame\";\n// import { duck } from \"./zzz/donaldDuck\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction PlayGame() {\n  _s();\n\n  const [players, setPlayers] = React.useState(null);\n  const [plot, setPlot] = React.useState(null);\n  const [title, setTitle] = React.useState(null);\n  const [cover, setCover] = React.useState(null);\n  const [played, setPlayed] = React.useState(false);\n  const [recordId, setRecordId] = React.useState(null);\n  const [progress, setProgress] = React.useState(0);\n  const [score, setScore] = React.useState(0);\n  const [qsNum, setQsNum] = React.useState(0);\n  const [oldScore, setOldScore] = React.useState(0);\n  const [oldNum, setOldNum] = React.useState(0);\n  const [subject, setSubject] = React.useState(null);\n  const [questions, setQuestions] = React.useState([null]);\n  const [topicName, setTopicName] = React.useState([null]);\n  const {\n    id,\n    topic\n  } = useParams();\n  const mountedRef = React.useRef(true); // ← the \"flag\"\n\n  React.useEffect(() => {\n    fetch(`http://localhost:8080/api/games/${id}`).then(res => res.json()).then(async data => {\n      var plot = JSON.parse(data.plot);\n      setPlot(plot);\n      setPlayers(data.players);\n      setTitle(data.name);\n      setCover(data.coverR);\n    });\n    getQuestions(topic);\n    getTopicName(topic);\n  }, []); // console.log(\"questions: \" + JSON.stringify(questions));\n\n  const getQuestions = () => {\n    fetch(`http://localhost:8080/api/questions/topic/${topic}`).then(response => response.json()).then(data => {\n      setQuestions(data);\n      setSubject(data[0].subject);\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  };\n\n  const getTopicName = () => {\n    fetch(`http://localhost:8080/api/topics/id/${topic}`).then(response => response.json()).then(data => {\n      setTopicName(data.code + \" \" + data.name);\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  };\n\n  React.useEffect(() => {\n    if (mountedRef.current) {\n      mountedRef.current = false;\n    } else {\n      // console.log(plot);\n      console.log(\"first block: \" + plot[1]);\n      var count = 0; // for (var i = 1; i < Object.keys(plot).length; i += 1) {\n      //   console.log(plot[i].type);\n      // }\n\n      for (let i in plot) {\n        if (plot[i].type == \"question\") {\n          // console.log(plot[i]);\n          var qNum = questions.length;\n          var rdQsId = Math.floor(Math.random() * qNum);\n          var qs = questions[rdQsId]; // console.log(questions);\n          // console.log(rdQsId);\n\n          questions.splice(rdQsId, 1); // console.log(\"qs: \" + JSON.stringify(qs));\n          // console.log(questions);\n\n          plot[i].text = qs.question;\n          plot[i].correct = qs.correctAns;\n          plot[i].explanation = qs.explanation;\n          console.log(plot[i]);\n        }\n      }\n    }\n  }, [questions]);\n  console.log(\"players: \" + players); // React.useEffect(() => {\n  //   addPlay(players + 1);\n  // }, []);\n\n  const addPlay = playerNum => {\n    const data = {\n      players: playerNum\n    };\n    fetch(`http://localhost:8080/api/games/${id}`, {\n      method: \"PUT\",\n      // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    }).then(response => response.json()).then(data => {\n      console.log(\"Success:\", data);\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  };\n\n  const createRecord = (score, end, profile, topic, game) => {\n    const data = {\n      score: score,\n      end: end,\n      profileId: profile,\n      topicId: topic,\n      gameId: game\n    };\n    fetch(`http://localhost:8080/api/records/`, {\n      method: \"POST\",\n      // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    }).then(response => response.json()).then(data => {\n      console.log(\"Success, record is created\", data); // 到时候如果游戏玩完了要改 end 和分数，可以根据 id 来改（不然找不着记录了）\n\n      setRecordId(data.id);\n      console.log(\"record is set at \", data.id);\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  };\n\n  const modifyRecord = end => {\n    const data = {\n      id: recordId,\n      score: score,\n      end: end\n    };\n    fetch(`http://localhost:8080/api/records/`, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    }).then(response => response.json()).then(data => {\n      console.log(\"Success, record is modified\", data);\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  };\n\n  const getUsrInfo = () => {\n    fetch(`http://localhost:8080/api/profiles/${uid}`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => res.json()).then(data => {\n      setOldScore(data.scores);\n      setOldNum(data.questions);\n    });\n  };\n\n  const upUsrInfo = () => {\n    const data = {\n      id: uid,\n      score: score,\n      questions: qsNum\n    };\n  }; // React.useEffect(() => {\n  //   addGame(plott);\n  //   console.log(\"Game added\");\n  // }, []);\n\n\n  const inputRef = React.useRef(null);\n  const contentScroll = React.useRef(null);\n  React.useEffect(() => {\n    inputRef.current.focus();\n    var contentBox = document.getElementsByClassName(\"summary\")[0];\n    contentBox.scrollTop = contentBox.scrollHeight - contentBox.offsetHeight;\n  }, []);\n\n  const scrollToBottom = () => {\n    var endPointer = document.getElementById(\"contentEnd\");\n    endPointer.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }; // state hooks\n  // var pointer = 1;\n\n\n  const [pointer, setPointer] = useState(1);\n  const [content, setContent] = useState(\"Press Enter to Start.\");\n  const [placeholder, setPlaceholder] = useState(\"Enter to continue…\");\n  const [confetti, setConfetti] = useState(false); // get user\n\n  if (getCurrentUser) {\n    // console.log(getCurrentUser);\n    const username = getCurrentUser.username;\n    var email = getCurrentUser.email;\n    var uid = getCurrentUser.id;\n    var roles = [];\n    getCurrentUser.roles.forEach((x, i) => roles.push(x.slice(5).toLowerCase())); // console.log(roles);\n  }\n\n  const calculateProgress = () => {\n    if (plot !== null) {\n      setProgress(pointer / Object.keys(plot).length * 100);\n    }\n  };\n\n  React.useEffect(() => {\n    calculateProgress();\n  }); // operations\n\n  const handleKeyDown = event => {\n    if (played === false) {\n      addPlay(players + 1);\n      setPlayed(true);\n\n      if (IsLoggedIn()) {\n        getUsrInfo();\n        createRecord(0, \"not done\", uid, topic, id);\n      }\n    }\n\n    console.log(\"key: \" + event.key);\n    console.log(\"pointer: \" + pointer);\n    console.log(\"type: \" + identifyType(pointer));\n    console.log(\"last plot pointer: \" + pointer);\n\n    if (identifyType(pointer) == \"story\") {\n      // 如果是剧情，那么框里啥也不能有\n      if (event.key) {\n        event.preventDefault();\n      } // 如果是投票，那么只能是 ABCD\n\n    } else if (identifyType(pointer) == \"vote\") {\n      console.log(\"Length: \" + event.target.value.length);\n\n      if ([\"A\", \"B\", \"C\", \"D\"].indexOf(event.key.toUpperCase()) == -1 || event.target.value.length + 1 > 1) {\n        event.preventDefault();\n      } // 如果是 option，那只能是指定的字母\n\n    } else if (identifyType(pointer) == \"option\") {\n      var options = plot[pointer].options.map(x => x[0]).flat(2);\n\n      if (options.indexOf(event.key.toUpperCase()) == -1 || event.target.value.length + 1 > 1) {\n        event.preventDefault();\n      }\n    } // 如果回车，那么执行提交函数\n\n\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      handleSubmit(event);\n    } else {\n      return false;\n    }\n  }; // 输入 Enter 提交后\n\n\n  const handleSubmit = e => {\n    setConfetti(false);\n    console.log(\"Submit!\");\n    console.log(\"Submitted content is: \" + e.target.value);\n    console.log(\"pointer is at: \" + pointer);\n\n    if (identifyType(pointer) == \"story\") {\n      setPlaceholder(\"Enter to continue…\");\n      console.log(\"is end?\" + plot[pointer].end);\n\n      if (plot[pointer].end === undefined) {\n        story(plot[pointer].text, plot[pointer].goto, e);\n      } else {\n        story(plot[pointer].text, plot[pointer].goto, e, plot[pointer].end);\n      } // pointer = newAddress(pointer);\n\n    } else if (identifyType(pointer) == \"question\") {\n      setPlaceholder(\"Input your answer…\");\n      question(plot[pointer].text, plot[pointer].correct, plot[pointer].explanation, plot[pointer].goto, e);\n      e.preventDefault();\n    } else if (identifyType(pointer) == \"vote\") {\n      setPlaceholder(\"Vote someone…\");\n      vote(plot[pointer].text, plot[pointer].choices, plot[pointer].goto, e.target.value);\n    } else if (identifyType(pointer) == \"option\") {\n      setPlaceholder(\"Make an option…\");\n      option(plot[pointer].text, plot[pointer].options, plot[pointer].goto, e.target.value);\n    }\n\n    e.target.value = null;\n    scrollToBottom();\n  }; //弄一个读取 key down 的，一个 submit form 的。key down\n  //的用于控制用户可以输入什么不可以输入什么；譬如剧情不能打字只能输入\"enter\"。\n  // identify type first\n\n\n  const identifyType = pointer => {\n    return plot[pointer].type;\n  }; // self-defined functions\n\n\n  const story = (text, goto, e, end) => {\n    output(text);\n    setPointer(goto);\n    e.preventDefault(); // if (pointer == \"end\") {\n    //   setConfetti(true);\n    // }\n\n    console.log(\"end: \" + end);\n\n    if (end == \"true\") {\n      setConfetti(true);\n    }\n\n    if (IsLoggedIn()) {\n      if (end !== null && end !== undefined) {\n        modifyRecord(end);\n      }\n    }\n  };\n\n  const question = (text, correct, explanation, goto, e) => {\n    if (e.target.value === \"\") {\n      // console.log(\"no input yet!\");\n      output(text);\n    } else {\n      // output(userinput);\n      // console.log(\"user answer: \" + userinput + \"correct answer: \" + correct);\n      var input = e.target.value;\n      var correctAnswer = correct; // 判断用户回答是否正确\n\n      if (checkAnswer(input, correctAnswer)) {\n        addCorrect(text);\n        output(input + \"\\n\\nCorrect! Great job! The plot now continues…\");\n        setConfetti(true);\n        setPointer(goto[0]);\n        setScore(score + 100);\n      } else {\n        addWrong(text);\n        output(input + \"\\n\\nYour answer is wrong! The correct answer is: \" + correct + \"\\n\\n\" + explanation);\n        setPointer(goto[1]);\n      }\n\n      setQsNum(qsNum + 1);\n      setPlaceholder(\"Enter to continue…\");\n      e.preventDefault();\n    }\n  };\n\n  const vote = (text, choices, goto, userinput) => {\n    if (userinput === \"\") {\n      output(text);\n    } else {\n      var input = userinput;\n      input = input.toUpperCase();\n      var choiceIndex;\n\n      switch (input) {\n        case \"A\":\n          choiceIndex = 0;\n          break;\n\n        case \"B\":\n          choiceIndex = 1;\n          break;\n\n        case \"C\":\n          choiceIndex = 2;\n          break;\n\n        case \"D\":\n          choiceIndex = 3;\n          break;\n      }\n\n      output(\"You voted [\" + input + \"]\" + choices[choiceIndex]);\n      setPointer(goto[choiceIndex]);\n    }\n\n    setPlaceholder(\"Enter to continue…\");\n  };\n\n  const option = (text, optionGroups, goto, userinput) => {\n    if (userinput === \"\") {\n      output(text);\n    } else {\n      var input = userinput;\n      input = input.toUpperCase();\n      var options = plot[pointer].options.map(x => x[0]).flat(2);\n      var optionIndex = options.indexOf(input);\n      console.log(\"optionIndex: \" + optionIndex);\n      console.log(\"optionGroups: \" + optionGroups);\n      output(\"Your option is [\" + input + \"]\" + optionGroups[optionIndex][1]);\n      setPointer(goto[optionIndex]);\n      console.log(\"setPointer: \" + goto[optionIndex]);\n    }\n\n    setPlaceholder(\"Enter to continue…\");\n  };\n\n  const newAddress = pointer => {\n    var newAddress = plot[pointer].goto;\n    return newAddress;\n  };\n\n  const checkAnswer = (userInput, correctAnswer) => {\n    if (userInput === correctAnswer) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  function ShowConfetti(props) {\n    const confetti = props.confetti;\n\n    if (confetti) {\n      return /*#__PURE__*/_jsxDEV(Confetti, {\n        recycle: false,\n        initialVelocityY: -20,\n        numberOfPieces: 100,\n        colors: [\"#F7CF56\", \"#D0D0D0\", \"#282828\"]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 9\n      }, this);\n    } else {\n      return null;\n    }\n  }\n\n  const addCorrect = question => {\n    setQHistory(qHistory.concat([[question, \"correct\"]]));\n  };\n\n  const addWrong = question => {\n    setQHistory(qHistory.concat([[question, \"wrong\"]]));\n  };\n\n  const [qHistory, setQHistory] = useState([]); // detail ones\n\n  const output = text => {\n    setContent(content + \"\\n\\n\" + text);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"playGame\",\n    children: [/*#__PURE__*/_jsxDEV(ShowConfetti, {\n      confetti: confetti\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {\n      autoClose: 2000,\n      theme: \"dark\",\n      transition: Slide\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chapters\",\n      children: [cover != null && /*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"cover\",\n        src: cover\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 27\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"game-title\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Subject\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 13\n          }, this), \"\\xA0\", subject]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 471,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"\\xA0\\xA0Topic\\xA0\\xA0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 476,\n            columnNumber: 13\n          }, this), \"\\xA0\", topicName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 475,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"current-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          title: \"You will receive your scores once the game reaches an end.\",\n          children: [\"Temporary score: \", score]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          title: \"Right or wrong\\u2026\",\n          children: [\"Question answered: \", qsNum]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 484,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"story\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-container\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress\",\n          style: {\n            width: `${progress}%`\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 489,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"summary\",\n        children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 494,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 11\n        }, this), content + \"\\n\\n\\n\\n\\n\\n\\n\", /*#__PURE__*/_jsxDEV(\"span\", {\n          id: \"contentEnd\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"input\",\n          placeholder: placeholder,\n          onKeyPress: handleKeyDown,\n          ref: inputRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"questions\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"history\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"History\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 11\n        }, this), qHistory.map(questionText => {\n          if (questionText[1] == \"correct\") {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"question-container correct\",\n              children: questionText[0]\n            }, questionText[0], false, {\n              fileName: _jsxFileName,\n              lineNumber: 515,\n              columnNumber: 17\n            }, this);\n          } else {\n            console.log(\"Question text: \" + questionText);\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"question-container wrong\",\n              children: questionText[0]\n            }, questionText[0], false, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 17\n            }, this);\n          }\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrong-questions\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Wrong answers\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"download-box\",\n          onClick: () => downloadPDF(qHistory),\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: download\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 535,\n            columnNumber: 13\n          }, this), \"Download Questions\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 11\n        }, this), qHistory.map(questionText => {\n          if (questionText[1] == \"wrong\") {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"question-container wrong\",\n              children: questionText[0]\n            }, questionText[0], false, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 17\n            }, this);\n          }\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 463,\n    columnNumber: 5\n  }, this);\n}\n\n_s(PlayGame, \"AiDv0wa0K37eQf6WsqItjE4eHmY=\", false, function () {\n  return [useParams];\n});\n\n_c = PlayGame;\nexport default PlayGame;\n\nvar _c;\n\n$RefreshReg$(_c, \"PlayGame\");","map":{"version":3,"names":["useParams","ToastContainer","toast","Slide","React","useState","IsLoggedIn","logout","getCurrentUser","Confetti","progress","download","downloadPDF","PlayGame","players","setPlayers","plot","setPlot","title","setTitle","cover","setCover","played","setPlayed","recordId","setRecordId","setProgress","score","setScore","qsNum","setQsNum","oldScore","setOldScore","oldNum","setOldNum","subject","setSubject","questions","setQuestions","topicName","setTopicName","id","topic","mountedRef","useRef","useEffect","fetch","then","res","json","data","JSON","parse","name","coverR","getQuestions","getTopicName","response","catch","error","console","code","current","log","count","i","type","qNum","length","rdQsId","Math","floor","random","qs","splice","text","question","correct","correctAns","explanation","addPlay","playerNum","method","headers","body","stringify","createRecord","end","profile","game","profileId","topicId","gameId","modifyRecord","getUsrInfo","uid","scores","upUsrInfo","inputRef","contentScroll","focus","contentBox","document","getElementsByClassName","scrollTop","scrollHeight","offsetHeight","scrollToBottom","endPointer","getElementById","scrollIntoView","behavior","pointer","setPointer","content","setContent","placeholder","setPlaceholder","confetti","setConfetti","username","email","roles","forEach","x","push","slice","toLowerCase","calculateProgress","Object","keys","handleKeyDown","event","key","identifyType","preventDefault","target","value","indexOf","toUpperCase","options","map","flat","handleSubmit","e","undefined","story","goto","vote","choices","option","output","input","correctAnswer","checkAnswer","addCorrect","addWrong","userinput","choiceIndex","optionGroups","optionIndex","newAddress","userInput","ShowConfetti","props","setQHistory","qHistory","concat","width","questionText"],"sources":["/Users/celia/Projects/Merakey/client/src/components/playGame.js"],"sourcesContent":["import \"../styles/playGame.scss\";\nimport { useParams } from \"react-router-dom\";\nimport { ToastContainer, toast, Slide } from \"react-toastify\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport React, { useState } from \"react\";\nimport IsLoggedIn, { logout, getCurrentUser } from \"./utilities/loginStatus\";\nimport Confetti from \"react-confetti\";\nimport progress from \"../images/progress.png\";\nimport download from \"../images/download.svg\";\nimport downloadPDF from \"./downloadWrong\";\n// import { plott } from \"./zzz/plot\";\n// import { addGame } from \"./utilities/addGame\";\n// import { duck } from \"./zzz/donaldDuck\";\n\nfunction PlayGame() {\n  const [players, setPlayers] = React.useState(null);\n  const [plot, setPlot] = React.useState(null);\n  const [title, setTitle] = React.useState(null);\n  const [cover, setCover] = React.useState(null);\n  const [played, setPlayed] = React.useState(false);\n  const [recordId, setRecordId] = React.useState(null);\n  const [progress, setProgress] = React.useState(0);\n  const [score, setScore] = React.useState(0);\n  const [qsNum, setQsNum] = React.useState(0);\n  const [oldScore, setOldScore] = React.useState(0);\n  const [oldNum, setOldNum] = React.useState(0);\n  const [subject, setSubject] = React.useState(null);\n  const [questions, setQuestions] = React.useState([null]);\n  const [topicName, setTopicName] = React.useState([null]);\n  const { id, topic } = useParams();\n  const mountedRef = React.useRef(true); // ← the \"flag\"\n\n  React.useEffect(() => {\n    fetch(`http://localhost:8080/api/games/${id}`)\n      .then((res) => res.json())\n      .then(async (data) => {\n        var plot = JSON.parse(data.plot);\n        setPlot(plot);\n        setPlayers(data.players);\n        setTitle(data.name);\n        setCover(data.coverR);\n      });\n    getQuestions(topic);\n    getTopicName(topic);\n  }, []);\n  // console.log(\"questions: \" + JSON.stringify(questions));\n\n  const getQuestions = () => {\n    fetch(`http://localhost:8080/api/questions/topic/${topic}`)\n      .then((response) => response.json())\n      .then((data) => {\n        setQuestions(data);\n        setSubject(data[0].subject);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const getTopicName = () => {\n    fetch(`http://localhost:8080/api/topics/id/${topic}`)\n      .then((response) => response.json())\n      .then((data) => {\n        setTopicName(data.code + \" \" + data.name);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n\n  React.useEffect(() => {\n    if (mountedRef.current) {\n      mountedRef.current = false;\n    } else {\n      // console.log(plot);\n      console.log(\"first block: \" + plot[1]);\n      var count = 0;\n      // for (var i = 1; i < Object.keys(plot).length; i += 1) {\n      //   console.log(plot[i].type);\n      // }\n      for (let i in plot) {\n        if (plot[i].type == \"question\") {\n          // console.log(plot[i]);\n          var qNum = questions.length;\n          var rdQsId = Math.floor(Math.random() * qNum);\n          var qs = questions[rdQsId];\n          // console.log(questions);\n          // console.log(rdQsId);\n          questions.splice(rdQsId, 1);\n          // console.log(\"qs: \" + JSON.stringify(qs));\n          // console.log(questions);\n          plot[i].text = qs.question;\n          plot[i].correct = qs.correctAns;\n          plot[i].explanation = qs.explanation;\n          console.log(plot[i]);\n        }\n      }\n    }\n  }, [questions]);\n\n  console.log(\"players: \" + players);\n  // React.useEffect(() => {\n  //   addPlay(players + 1);\n  // }, []);\n\n  const addPlay = (playerNum) => {\n    const data = { players: playerNum };\n    fetch(`http://localhost:8080/api/games/${id}`, {\n      method: \"PUT\", // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"Success:\", data);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const createRecord = (score, end, profile, topic, game) => {\n    const data = {\n      score: score,\n      end: end,\n      profileId: profile,\n      topicId: topic,\n      gameId: game,\n    };\n    fetch(`http://localhost:8080/api/records/`, {\n      method: \"POST\", // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"Success, record is created\", data);\n        // 到时候如果游戏玩完了要改 end 和分数，可以根据 id 来改（不然找不着记录了）\n        setRecordId(data.id);\n        console.log(\"record is set at \", data.id);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n\n  const modifyRecord = (end) => {\n    const data = { id: recordId, score: score, end: end };\n    fetch(`http://localhost:8080/api/records/`, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"Success, record is modified\", data);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const getUsrInfo = () => {\n    fetch(`http://localhost:8080/api/profiles/${uid}`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => res.json())\n      .then((data) => {\n        setOldScore(data.scores);\n        setOldNum(data.questions);\n      });\n  };\n  const upUsrInfo = () => {\n    const data = { id: uid, score: score, questions: qsNum };\n  };\n  // React.useEffect(() => {\n  //   addGame(plott);\n  //   console.log(\"Game added\");\n  // }, []);\n\n  const inputRef = React.useRef(null);\n  const contentScroll = React.useRef(null);\n  React.useEffect(() => {\n    inputRef.current.focus();\n    var contentBox = document.getElementsByClassName(\"summary\")[0];\n    contentBox.scrollTop = contentBox.scrollHeight - contentBox.offsetHeight;\n  }, []);\n  const scrollToBottom = () => {\n    var endPointer = document.getElementById(\"contentEnd\");\n    endPointer.scrollIntoView({ behavior: \"smooth\" });\n  };\n  // state hooks\n  // var pointer = 1;\n  const [pointer, setPointer] = useState(1);\n  const [content, setContent] = useState(\"Press Enter to Start.\");\n  const [placeholder, setPlaceholder] = useState(\"Enter to continue…\");\n  const [confetti, setConfetti] = useState(false);\n\n  // get user\n  if (getCurrentUser) {\n    // console.log(getCurrentUser);\n    const username = getCurrentUser.username;\n    var email = getCurrentUser.email;\n    var uid = getCurrentUser.id;\n    var roles = [];\n    getCurrentUser.roles.forEach((x, i) =>\n      roles.push(x.slice(5).toLowerCase())\n    );\n    // console.log(roles);\n  }\n\n  const calculateProgress = () => {\n    if (plot !== null) {\n      setProgress((pointer / Object.keys(plot).length) * 100);\n    }\n  };\n  React.useEffect(() => {\n    calculateProgress();\n  });\n\n  // operations\n  const handleKeyDown = (event) => {\n    if (played === false) {\n      addPlay(players + 1);\n      setPlayed(true);\n      if (IsLoggedIn()) {\n        getUsrInfo();\n        createRecord(0, \"not done\", uid, topic, id);\n      }\n    }\n    console.log(\"key: \" + event.key);\n    console.log(\"pointer: \" + pointer);\n    console.log(\"type: \" + identifyType(pointer));\n    console.log(\"last plot pointer: \" + pointer);\n    if (identifyType(pointer) == \"story\") {\n      // 如果是剧情，那么框里啥也不能有\n      if (event.key) {\n        event.preventDefault();\n      }\n      // 如果是投票，那么只能是 ABCD\n    } else if (identifyType(pointer) == \"vote\") {\n      console.log(\"Length: \" + event.target.value.length);\n      if (\n        [\"A\", \"B\", \"C\", \"D\"].indexOf(event.key.toUpperCase()) == -1 ||\n        event.target.value.length + 1 > 1\n      ) {\n        event.preventDefault();\n      }\n      // 如果是 option，那只能是指定的字母\n    } else if (identifyType(pointer) == \"option\") {\n      var options = plot[pointer].options.map((x) => x[0]).flat(2);\n      if (\n        options.indexOf(event.key.toUpperCase()) == -1 ||\n        event.target.value.length + 1 > 1\n      ) {\n        event.preventDefault();\n      }\n    }\n    // 如果回车，那么执行提交函数\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      handleSubmit(event);\n    } else {\n      return false;\n    }\n  };\n  // 输入 Enter 提交后\n  const handleSubmit = (e) => {\n    setConfetti(false);\n    console.log(\"Submit!\");\n    console.log(\"Submitted content is: \" + e.target.value);\n    console.log(\"pointer is at: \" + pointer);\n    if (identifyType(pointer) == \"story\") {\n      setPlaceholder(\"Enter to continue…\");\n      console.log(\"is end?\" + plot[pointer].end);\n      if (plot[pointer].end === undefined) {\n        story(plot[pointer].text, plot[pointer].goto, e);\n      } else {\n        story(plot[pointer].text, plot[pointer].goto, e, plot[pointer].end);\n      }\n      // pointer = newAddress(pointer);\n    } else if (identifyType(pointer) == \"question\") {\n      setPlaceholder(\"Input your answer…\");\n      question(\n        plot[pointer].text,\n        plot[pointer].correct,\n        plot[pointer].explanation,\n        plot[pointer].goto,\n        e\n      );\n      e.preventDefault();\n    } else if (identifyType(pointer) == \"vote\") {\n      setPlaceholder(\"Vote someone…\");\n      vote(\n        plot[pointer].text,\n        plot[pointer].choices,\n        plot[pointer].goto,\n        e.target.value\n      );\n    } else if (identifyType(pointer) == \"option\") {\n      setPlaceholder(\"Make an option…\");\n      option(\n        plot[pointer].text,\n        plot[pointer].options,\n        plot[pointer].goto,\n        e.target.value\n      );\n    }\n    e.target.value = null;\n    scrollToBottom();\n  };\n  //弄一个读取 key down 的，一个 submit form 的。key down\n  //的用于控制用户可以输入什么不可以输入什么；譬如剧情不能打字只能输入\"enter\"。\n\n  // identify type first\n  const identifyType = (pointer) => {\n    return plot[pointer].type;\n  };\n\n  // self-defined functions\n  const story = (text, goto, e, end) => {\n    output(text);\n    setPointer(goto);\n    e.preventDefault();\n    // if (pointer == \"end\") {\n    //   setConfetti(true);\n    // }\n    console.log(\"end: \" + end);\n    if (end == \"true\") {\n      setConfetti(true);\n    }\n    if (IsLoggedIn()) {\n      if (end !== null && end !== undefined) {\n        modifyRecord(end);\n      }\n    }\n  };\n  const question = (text, correct, explanation, goto, e) => {\n    if (e.target.value === \"\") {\n      // console.log(\"no input yet!\");\n      output(text);\n    } else {\n      // output(userinput);\n      // console.log(\"user answer: \" + userinput + \"correct answer: \" + correct);\n\n      var input = e.target.value;\n      var correctAnswer = correct;\n      // 判断用户回答是否正确\n      if (checkAnswer(input, correctAnswer)) {\n        addCorrect(text);\n        output(input + \"\\n\\nCorrect! Great job! The plot now continues…\");\n        setConfetti(true);\n        setPointer(goto[0]);\n        setScore(score + 100);\n      } else {\n        addWrong(text);\n        output(\n          input +\n            \"\\n\\nYour answer is wrong! The correct answer is: \" +\n            correct +\n            \"\\n\\n\" +\n            explanation\n        );\n        setPointer(goto[1]);\n      }\n      setQsNum(qsNum + 1);\n      setPlaceholder(\"Enter to continue…\");\n      e.preventDefault();\n    }\n  };\n  const vote = (text, choices, goto, userinput) => {\n    if (userinput === \"\") {\n      output(text);\n    } else {\n      var input = userinput;\n      input = input.toUpperCase();\n      var choiceIndex;\n      switch (input) {\n        case \"A\":\n          choiceIndex = 0;\n          break;\n        case \"B\":\n          choiceIndex = 1;\n          break;\n        case \"C\":\n          choiceIndex = 2;\n          break;\n        case \"D\":\n          choiceIndex = 3;\n          break;\n      }\n      output(\"You voted [\" + input + \"]\" + choices[choiceIndex]);\n      setPointer(goto[choiceIndex]);\n    }\n    setPlaceholder(\"Enter to continue…\");\n  };\n  const option = (text, optionGroups, goto, userinput) => {\n    if (userinput === \"\") {\n      output(text);\n    } else {\n      var input = userinput;\n      input = input.toUpperCase();\n      var options = plot[pointer].options.map((x) => x[0]).flat(2);\n      var optionIndex = options.indexOf(input);\n      console.log(\"optionIndex: \" + optionIndex);\n      console.log(\"optionGroups: \" + optionGroups);\n      output(\"Your option is [\" + input + \"]\" + optionGroups[optionIndex][1]);\n      setPointer(goto[optionIndex]);\n      console.log(\"setPointer: \" + goto[optionIndex]);\n    }\n    setPlaceholder(\"Enter to continue…\");\n  };\n  const newAddress = (pointer) => {\n    var newAddress = plot[pointer].goto;\n    return newAddress;\n  };\n  const checkAnswer = (userInput, correctAnswer) => {\n    if (userInput === correctAnswer) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  function ShowConfetti(props) {\n    const confetti = props.confetti;\n    if (confetti) {\n      return (\n        <Confetti\n          recycle={false}\n          initialVelocityY={-20}\n          numberOfPieces={100}\n          colors={[\"#F7CF56\", \"#D0D0D0\", \"#282828\"]}\n        />\n      );\n    } else {\n      return null;\n    }\n  }\n\n  const addCorrect = (question) => {\n    setQHistory(qHistory.concat([[question, \"correct\"]]));\n  };\n\n  const addWrong = (question) => {\n    setQHistory(qHistory.concat([[question, \"wrong\"]]));\n  };\n\n  const [qHistory, setQHistory] = useState([]);\n\n  // detail ones\n  const output = (text) => {\n    setContent(content + \"\\n\\n\" + text);\n  };\n\n  return (\n    <div className=\"playGame\">\n      <ShowConfetti confetti={confetti} />\n      <ToastContainer autoClose={2000} theme=\"dark\" transition={Slide} />\n      <div className=\"chapters\">\n        {cover != null && <img className=\"cover\" src={cover} />}\n\n        <h3 className=\"game-title\">{title}</h3>\n        <div className=\"game-info\">\n          <p>\n            <span>Subject</span>\n            &nbsp;{subject}\n          </p>\n          <p>\n            <span>&nbsp;&nbsp;Topic&nbsp;&nbsp;</span>\n            &nbsp;{topicName}\n          </p>\n        </div>\n        <div className=\"current-info\">\n          <p title=\"You will receive your scores once the game reaches an end.\">\n            Temporary score: {score}\n          </p>\n          <p title=\"Right or wrong…\">Question answered: {qsNum}</p>\n        </div>\n      </div>\n      <div className=\"story\">\n        <div className=\"progress-container\">\n          <div className=\"progress\" style={{ width: `${progress}%` }} />\n        </div>\n        <p className=\"summary\">\n          <br />\n          <br />\n          <br />\n\n          <br />\n          {content + \"\\n\\n\\n\\n\\n\\n\\n\"}\n          <span id=\"contentEnd\"></span>\n        </p>\n        <form>\n          <input\n            className=\"input\"\n            placeholder={placeholder}\n            onKeyPress={handleKeyDown}\n            ref={inputRef}\n          />\n        </form>\n      </div>\n      <div className=\"questions\">\n        <div className=\"history\">\n          <h3>History</h3>\n          {qHistory.map((questionText) => {\n            if (questionText[1] == \"correct\") {\n              return (\n                <div\n                  className=\"question-container correct\"\n                  key={questionText[0]}\n                >\n                  {questionText[0]}\n                </div>\n              );\n            } else {\n              console.log(\"Question text: \" + questionText);\n              return (\n                <div className=\"question-container wrong\" key={questionText[0]}>\n                  {questionText[0]}\n                </div>\n              );\n            }\n          })}\n        </div>\n        <div className=\"wrong-questions\">\n          <h3>Wrong answers</h3>\n          <div className=\"download-box\" onClick={() => downloadPDF(qHistory)}>\n            <img src={download} />\n            Download Questions\n          </div>\n          {qHistory.map((questionText) => {\n            if (questionText[1] == \"wrong\") {\n              return (\n                <div className=\"question-container wrong\" key={questionText[0]}>\n                  {questionText[0]}\n                </div>\n              );\n            }\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\nexport default PlayGame;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}