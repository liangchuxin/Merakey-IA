{"ast":null,"code":"import _slicedToArray from\"/Users/celia/Projects/Merakey/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"../styles/search.scss\";import searchIco from\"../images/search.svg\";import React,{useEffect,useState,useRef}from\"react\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export function Search(props){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),searchState=_React$useState2[0],setSearchState=_React$useState2[1];var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),query=_useState2[0],setQuery=_useState2[1];var navigate=useNavigate();var mountedRef=React.useRef(true);// ← the \"flag\"\nfunction useOutsideAlerter(ref){useEffect(function(){function handleClickOutside(event){if(ref.current&&!ref.current.contains(event.target)){closeSearch();}}document.addEventListener(\"mousedown\",handleClickOutside);return function(){document.removeEventListener(\"mousedown\",handleClickOutside);};},[ref]);}var wrapperRef=useRef(null);useOutsideAlerter(wrapperRef);React.useEffect(function(){if(props.show){openSearch();}else{closeSearch();}});React.useEffect(function(){// 我也搞不懂 ref，所以此处用了个不用 ref 自动选择的笨方法\nif(mountedRef.current){mountedRef.current=false;}else{if(searchState){document.getElementById(\"searchfield\").focus();}}});var handleSubmit=function handleSubmit(e){e.preventDefault();setQuery(query);navigate(\"/search/\".concat(query));closeSearch();props.closeParent(false);return false;};var closeSearch=function closeSearch(e){setSearchState(false);props.closeParent(false);};var openSearch=function openSearch(){setSearchState(true);};var handleClick=function handleClick(event){event.preventDefault();event.stopPropagation();return false;};// React.useEffect(() => {\nif(searchState===true){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-box-backdrop\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search\",children:/*#__PURE__*/_jsxs(\"form\",{class:\"search-form\",name:\"search\",ref:wrapperRef,onSubmit:function onSubmit(e){return handleSubmit(e);},children:[/*#__PURE__*/_jsx(\"input\",{class:\"search-field\",id:\"searchfield\",type:\"text\",name:\"q\",placeholder:\"Search games and subject topics\\u2026\",onChange:function onChange(event){return setQuery(event.target.value);}}),/*#__PURE__*/_jsxs(\"button\",{class:\"appear-button always-appear\",type:\"button\",id:\"searchsubmit\",onClick:function onClick(e){return handleSubmit(e);},children:[/*#__PURE__*/_jsx(\"img\",{className:\"search-icon\",src:searchIco}),/*#__PURE__*/_jsx(\"i\",{class:\"icon icon-search\",\"aria-hidden\":\"true\"})]}),/*#__PURE__*/_jsx(\"button\",{class:\"search-button\",onClick:function onClick(e){return handleSubmit(e);},children:/*#__PURE__*/_jsx(\"i\",{class:\"icon icon-search\",\"aria-hidden\":\"true\"})})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return closeSearch();},class:\"search-wrapper-close\",\"aria-label\":\"Close\"})]})});}else if(searchState===false){return null;}}","map":{"version":3,"names":["searchIco","React","useEffect","useState","useRef","useNavigate","Search","props","searchState","setSearchState","query","setQuery","navigate","mountedRef","useOutsideAlerter","ref","handleClickOutside","event","current","contains","target","closeSearch","document","addEventListener","removeEventListener","wrapperRef","show","openSearch","getElementById","focus","handleSubmit","e","preventDefault","closeParent","handleClick","stopPropagation","value"],"sources":["/Users/celia/Projects/Merakey/client/src/components/search.js"],"sourcesContent":["import \"../styles/search.scss\";\nimport searchIco from \"../images/search.svg\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nexport function Search(props) {\n  const [searchState, setSearchState] = React.useState(false);\n  const [query, setQuery] = useState(\"\");\n  const navigate = useNavigate();\n  const mountedRef = React.useRef(true); // ← the \"flag\"\n\n  function useOutsideAlerter(ref) {\n    useEffect(() => {\n      function handleClickOutside(event) {\n        if (ref.current && !ref.current.contains(event.target)) {\n          closeSearch();\n        }\n      }\n      document.addEventListener(\"mousedown\", handleClickOutside);\n      return () => {\n        document.removeEventListener(\"mousedown\", handleClickOutside);\n      };\n    }, [ref]);\n  }\n  const wrapperRef = useRef(null);\n  useOutsideAlerter(wrapperRef);\n  React.useEffect(() => {\n    if (props.show) {\n      openSearch();\n    } else {\n      closeSearch();\n    }\n  });\n  React.useEffect(() => {\n    // 我也搞不懂 ref，所以此处用了个不用 ref 自动选择的笨方法\n    if (mountedRef.current) {\n      mountedRef.current = false;\n    } else {\n      if (searchState) {\n        document.getElementById(\"searchfield\").focus();\n      }\n    }\n  });\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    setQuery(query);\n    navigate(`/search/${query}`);\n    closeSearch();\n    props.closeParent(false);\n    return false;\n  };\n  const closeSearch = (e) => {\n    setSearchState(false);\n    props.closeParent(false);\n  };\n  const openSearch = () => {\n    setSearchState(true);\n  };\n  const handleClick = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  };\n  // React.useEffect(() => {\n  if (searchState === true) {\n    return (\n      <>\n        <div className=\"search-box-backdrop\">\n          <div className=\"search\">\n            <form\n              class=\"search-form\"\n              name=\"search\"\n              ref={wrapperRef}\n              onSubmit={(e) => handleSubmit(e)}\n            >\n              <input\n                class=\"search-field\"\n                id=\"searchfield\"\n                type=\"text\"\n                name=\"q\"\n                placeholder=\"Search games and subject topics…\"\n                onChange={(event) => setQuery(event.target.value)}\n              />\n              <button\n                class=\"appear-button always-appear\"\n                type=\"button\"\n                id=\"searchsubmit\"\n                onClick={(e) => handleSubmit(e)}\n              >\n                <img className=\"search-icon\" src={searchIco} />\n                <i class=\"icon icon-search\" aria-hidden=\"true\"></i>\n              </button>\n              <button class=\"search-button\" onClick={(e) => handleSubmit(e)}>\n                <i class=\"icon icon-search\" aria-hidden=\"true\"></i>\n              </button>\n            </form>\n          </div>\n          <button\n            onClick={() => closeSearch()}\n            class=\"search-wrapper-close\"\n            aria-label=\"Close\"\n          ></button>\n        </div>\n      </>\n    );\n  } else if (searchState === false) {\n    return null;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}