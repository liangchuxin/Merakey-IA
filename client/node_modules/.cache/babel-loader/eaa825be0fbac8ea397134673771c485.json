{"ast":null,"code":"import _regeneratorRuntime from\"/Users/celia/Projects/Merakey/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/celia/Projects/Merakey/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/celia/Projects/Merakey/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"../styles/gameDetails.scss\";import rating from\"../images/rating.png\";import leaderboard from\"../images/game-leaderboard.png\";// import cover from \"../images/whodidit.png\";\nimport React,{useEffect,useRef}from\"react\";import{useNavigate}from\"react-router-dom\";import{ToastContainer,toast,Slide}from\"react-toastify\";import{useParams}from\"react-router-dom\";import IsLoggedIn,{logout,getCurrentUser}from\"./utilities/loginStatus\";//icons\nimport promptIco from\"../images/login-prompt.svg\";import closeIco from\"../images/close.svg\";// import { comments } from \"../../../api/app/models\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function nestComments(commentList){var commentMap={};// 先把 commentList 转为名为 commentMap 的 array（本来是个 list）\ncommentList.forEach(function(comment){return commentMap[comment.id]=comment;});// iterate over the comments again and correctly nest the children\ncommentList.forEach(function(comment){if(comment.parentId!==null){var parent=commentMap[comment.parentId];// parent 就是这个数组里 id 评论 parentId 的那条评论\n(parent.children=parent.children||[]).push(comment);// 上面这个等于 parent.children = parent.children ? parent.children : []\n// 如果 parent 有 children 的 attribute，那就把这条 comment 整条 push 进去，如果没有，就创建这个 attribute 然后 push 进去\n}});// 这个时候，所有子评论都被放到母评论里了，所有有 parentId 的都是母评论，子评论都被装在母评论里面了，漏在外面的子评论不用理会\n// filter the list to return a list of correctly nested comments\nreturn commentList.filter(function(comment){return comment.parentId===null;});}function GameDetails(){var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),name=_React$useState2[0],setName=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),desc=_React$useState4[0],setDesc=_React$useState4[1];var _React$useState5=React.useState(null),_React$useState6=_slicedToArray(_React$useState5,2),author=_React$useState6[0],setAuthor=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),players=_React$useState8[0],setPlayers=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),views=_React$useState10[0],setViews=_React$useState10[1];var _React$useState11=React.useState(null),_React$useState12=_slicedToArray(_React$useState11,2),cover=_React$useState12[0],setCover=_React$useState12[1];var _React$useState13=React.useState([]),_React$useState14=_slicedToArray(_React$useState13,2),comments=_React$useState14[0],setComments=_React$useState14[1];var _React$useState15=React.useState(0),_React$useState16=_slicedToArray(_React$useState15,2),commentNum=_React$useState16[0],setCommentNum=_React$useState16[1];var _React$useState17=React.useState(\"summary\"),_React$useState18=_slicedToArray(_React$useState17,2),tabState=_React$useState18[0],setTabState=_React$useState18[1];var _React$useState19=React.useState(\"\"),_React$useState20=_slicedToArray(_React$useState19,2),content=_React$useState20[0],setContent=_React$useState20[1];var _React$useState21=React.useState(0),_React$useState22=_slicedToArray(_React$useState21,2),replyto=_React$useState22[0],setReplyto=_React$useState22[1];var _React$useState23=React.useState(true),_React$useState24=_slicedToArray(_React$useState23,2),popupState=_React$useState24[0],setPopupState=_React$useState24[1];var _React$useState25=React.useState(\"null\"),_React$useState26=_slicedToArray(_React$useState25,2),subject=_React$useState26[0],setSubject=_React$useState26[1];var _React$useState27=React.useState([\"null\"]),_React$useState28=_slicedToArray(_React$useState27,2),topics=_React$useState28[0],setTopics=_React$useState28[1];var _React$useState29=React.useState(\"null\"),_React$useState30=_slicedToArray(_React$useState29,2),topic=_React$useState30[0],setTopic=_React$useState30[1];var mountedRef=React.useRef(true);// ← the \"flag\"\nvar _useParams=useParams(),id=_useParams.id;// console.log(\"id: \" + id);\nfunction GetUser(uid,field){var response=fetch(\"http://localhost:8080/api/profiles/\".concat(uid)).then(function(res){return res.json();}).then(function(data){// console.log(\"data of user \" + uid + \": \" + JSON.stringify(data.avatar));\nswitch(field){case\"avatar\":// console.log(\"#222 avatar\" + JSON.stringify(data.avatar));\nreturn JSON.stringify(data.avatar);case\"username\":return data.displayName;case\"status\":return data.status;}return JSON.stringify(data.avatar);});// console.log(\"#333 response: \" + response);\nreturn response;}var refreshPage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:fetch(\"http://localhost:8080/api/games/\".concat(id)).then(function(res){return res.json();}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(data){var author,comments,index,user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setName(data.name);setDesc(data.description);setPlayers(data.players);setViews(data.views);setCover(data.coverW);setCommentNum(data.comments.length);_context.next=8;return GetUser(data.authorId,\"username\");case 8:author=_context.sent;setAuthor(author);// console.log(\"comments: \" + JSON.stringify(nestComments(data.comments)));\ncomments=data.comments;index=0;case 12:if(!(index<comments.length)){_context.next=26;break;}user=comments[index].profileId;_context.next=16;return GetUser(user,\"avatar\");case 16:comments[index].avatar=_context.sent;_context.next=19;return GetUser(user,\"username\");case 19:comments[index].username=_context.sent;_context.next=22;return GetUser(user,\"status\");case 22:comments[index].status=_context.sent;case 23:index++;_context.next=12;break;case 26:setComments(nestComments(data.comments).reverse());case 27:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function refreshPage(){return _ref.apply(this,arguments);};}();// const refreshPage = () => {\n//   fetch(`http://localhost:8080/api/games/${id}`)\n//     .then((res) => res.json())\n//     .then(async (data) => {\n//       var comments = data.comments;\n//       for (let index = 0; index < comments.length; index++) {\n//         var user = comments[index].profileId;\n//         comments[index].avatar = await GetUser(user, \"avatar\");\n//         comments[index].username = await GetUser(user, \"username\");\n//         comments[index].status = await GetUser(user, \"status\");\n//       }\n//       setComments(comments);\n//     });\n// };\nif(getCurrentUser){// console.log(getCurrentUser);\nvar username=getCurrentUser.username;var email=getCurrentUser.email;var userId=getCurrentUser.id;var roles=[];getCurrentUser.roles.forEach(function(x,i){return roles.push(x.slice(5).toLowerCase());});// console.log(roles);\n}function Comment(_ref3){var comment=_ref3.comment,level=_ref3.level;return function(level){// console.log(comment);\nif(!level){var level=0;}var user=comment.userId;var date=comment.createdAt.split(\"T\")[0];var time=comment.createdAt.split(\"T\")[1].split(\".\")[0];var content=comment.text;var author=parseInt(comment.profileId);var avatar=GetUser(author,\"avatar\");// console.log(\n//   \"#444 author is: \" + author + \" avatar is: \" + avatar + typeof avatar\n// );\nvar children=comment.children;if(level==0){// console.log(level);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"comment-block\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"comment-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:JSON.parse(comment.avatar)}),/*#__PURE__*/_jsx(\"span\",{className:\"user-status \".concat(comment.status),title:\"\".concat(comment.status,\"\\u2026\")})]}),/*#__PURE__*/_jsx(\"div\",{className:\"username\",children:/*#__PURE__*/_jsx(\"p\",{children:comment.username})}),/*#__PURE__*/_jsx(\"div\",{className:\"separator\"}),/*#__PURE__*/_jsx(\"div\",{className:\"date\",title:time,children:date})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-content\",children:/*#__PURE__*/_jsx(\"p\",{children:content})}),/*#__PURE__*/_jsxs(\"div\",{className:\"reply-comment\",style:replyto!==comment.id?{paddingBottom:\"40px\"}:{},children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setReplyto(comment.id);},children:\"Reply\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setReplyto(0);},style:replyto!==comment.id?{display:\"none\"}:{},children:\"Cancel Reply\"})]}),/*#__PURE__*/_jsx(CommentBox,{replyNum:replyto,commentId:comment.id}),children===null||children===void 0?void 0:children.map(function(subChildren){return/*#__PURE__*/_jsx(Comment,{comment:subChildren,level:level+1});})]},comment.id);}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"comment-block\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"comment-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:JSON.parse(comment.avatar)}),/*#__PURE__*/_jsx(\"span\",{className:\"user-status \".concat(comment.status),title:\"\".concat(comment.status,\"\\u2026\")}),\" \"]}),/*#__PURE__*/_jsx(\"div\",{className:\"username\",children:/*#__PURE__*/_jsx(\"p\",{children:comment.username})}),/*#__PURE__*/_jsx(\"div\",{className:\"separator\"}),/*#__PURE__*/_jsx(\"div\",{className:\"date\",title:time,children:date})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-content\",children:/*#__PURE__*/_jsx(\"p\",{children:content})}),/*#__PURE__*/_jsxs(\"div\",{className:\"reply-comment\",style:replyto!==comment.id?{paddingBottom:\"40px\"}:{},children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setReplyto(comment.id);},children:\"Reply\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setReplyto(0);},style:replyto!==comment.id?{display:\"none\"}:{},children:\"Cancel Reply\"})]}),/*#__PURE__*/_jsx(CommentBox,{replyNum:replyto,commentId:comment.id}),children===null||children===void 0?void 0:children.map(function(subChildren){return/*#__PURE__*/_jsx(Comment,{comment:subChildren,level:level+1});})]},comment.id);}}(level);}function SampleCmt(_ref4){var commentContent=_ref4.commentContent;var addToBox=function addToBox(commentContent){var commentBox=document.getElementById(\"comment-box\");commentBox.value+=commentContent+\" \";// setContent(commentBox.value);\n// console.log(\"Content in the box: \" + content);\ncommentBox.focus();};return/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return addToBox(commentContent);},children:commentContent});}React.useEffect(function(){refreshPage();},[]);function CommentBox(_ref5){var replyNum=_ref5.replyNum,commentId=_ref5.commentId;// console.log(\"content: \" + document.getElementById(\"comment-box\").value);\n// var originalValue = document.getElementById(\"comment-box\").value;\nif(replyNum==commentId){if(!IsLoggedIn()){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"comment-box\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Please \",/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return navigate(\"/signup\");},children:\"sign up\"}),\" \",\"or \",/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return navigate(\"/login\");},children:\"login\"}),\" to comment!\"]})})});}else{return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"comment-box\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:commentId===0?\"Please input a friendly comment\\u2026\":\"Reply to\\u2026\",id:\"comment-box\"// onChange={(event) => setContent(event.target.value)}\n// defaultValue={document.getElementById(\"comment-box\").value}\n}),/*#__PURE__*/_jsx(\"div\",{className:\"submit-btn\",onClick:function onClick(){return handleSubmit();},children:\"Submit\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sample-comments\",style:commentId===0?{paddingBottom:\"55px\"}:{paddingBottom:\"40px\"},children:[/*#__PURE__*/_jsx(SampleCmt,{commentContent:\"Nice game!\"}),/*#__PURE__*/_jsx(SampleCmt,{commentContent:\"Wonderful experience!\"})]})]});}}else{return null;}}React.useEffect(function(){if(mountedRef.current){mountedRef.current=false;}else{addView(views+1);console.log(\"there are \"+views+\" views\");}},[views]);React.useEffect(function(){window.scrollTo(0,0);},[]);// console.log(name, desc);\nvar navigate=useNavigate();var addView=function addView(viewNum){var data={views:viewNum};fetch(\"http://localhost:8080/api/games/\".concat(id),{method:\"PUT\",// or 'PUT'\nheaders:{\"Content-Type\":\"application/json\"},body:JSON.stringify(data)}).then(function(response){return response.json();}).then(function(data){console.log(\"Success:\",data);}).catch(function(error){console.error(\"Error:\",error);});};var submitComment=function submitComment(comment,parent,user){var data={text:comment,parentId:parent,userId:user};fetch(\"http://localhost:8080/api/comments/\".concat(id),{method:\"POST\",// or 'PUT'\nheaders:{\"Content-Type\":\"application/json\"},body:JSON.stringify(data)}).then(function(response){return response.json();}).then(function(data){console.log(\"Success:\",data);}).catch(function(error){console.error(\"Error:\",error);});};var handleSubmit=function handleSubmit(){var content=document.getElementById(\"comment-box\").value;console.log(\"Submit comment: \"+content);if(replyto==0){submitComment(content,null,userId);}else{submitComment(content,replyto,userId);}toast.success(\"Your comment is submitted!\",{position:toast.POSITION.BOTTOM_RIGHT,className:\"foo-bar\",onClose:function onClose(){content=\"\";document.getElementById(\"comment-box\").defaultValue=\"\";refreshPage();}});};var getTopics=function getTopics(subject){fetch(\"http://localhost:8080/api/topics/subject/\".concat(subject)).then(function(response){return response.json();}).then(function(data){setTopics(data);}).catch(function(error){console.error(\"Error:\",error);});};var submitSubject=function submitSubject(e){setSubject(e);setTopic(\"null\");getTopics(e);};var submitTopic=function submitTopic(e){setTopic(e);};console.log(\"topic: \"+topic);return/*#__PURE__*/_jsxs(_Fragment,{children:[!IsLoggedIn()&&popupState&&/*#__PURE__*/_jsxs(\"div\",{className:\"login-popup\",children:[/*#__PURE__*/_jsx(\"img\",{src:promptIco}),/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Login to see your progress!\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:\"Login or sign up to comment, view all your practice / game histories, and to track the wrong questions!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"btn-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"signup\",onClick:function onClick(){return navigate(\"/signup\");},children:\"Sign up\"}),/*#__PURE__*/_jsx(\"div\",{className:\"next\",onClick:function onClick(){return setPopupState(false);},children:\"Next time\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"close\",onClick:function onClick(){return setPopupState(false);},children:/*#__PURE__*/_jsx(\"img\",{src:closeIco})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"details-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"details\",children:[/*#__PURE__*/_jsx(ToastContainer,{autoClose:1000,theme:\"dark\",transition:Slide}),/*#__PURE__*/_jsx(\"div\",{className:\"cover-container\",children:/*#__PURE__*/_jsx(\"img\",{src:cover,style:{width:\"772px\"}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:name}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"author\",children:[\"By @\",author]}),/*#__PURE__*/_jsx(\"div\",{className:\"rating\",children:/*#__PURE__*/_jsx(\"img\",{src:rating})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"played\",children:[\"Played by: \",players,\" players\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"start-options\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"start-btn\".concat(topic==\"null\"?\" disabled\":\"\"),onClick:function onClick(){return navigate(\"play/\".concat(topic));},disabled:topic==\"null\"?true:false,children:\"Start Game\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"subject\",name:\"subject\",className:\"subject-dropdown\",onChange:function onChange(e){return submitSubject(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"null\",selected:subject===\"null\",children:\"Choose Subject\"}),/*#__PURE__*/_jsx(\"option\",{value:\"maths\",selected:subject==\"maths\",children:\"Maths\"}),/*#__PURE__*/_jsx(\"option\",{value:\"physics\",selected:subject==\"physics\",children:\"Physics\"})]}),JSON.stringify(topics)!=='[\"null\"]'&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"select\",{id:\"topic\",name:\"topic\",className:\"topic-dropdown\",onChange:function onChange(e){return submitTopic(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"none\",children:\"Choose Topic\"}),/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Topics\"}),topics.map(function(topicOption,index){return/*#__PURE__*/_jsxs(\"option\",{value:topicOption.id,children:[index+1,\". \",topicOption.code,\" \",topicOption.name]});})]})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"tabs\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:tabState===\"summary\"?\"active\":\"\",onClick:function onClick(){return setTabState(\"summary\");},children:\"Summary\"}),/*#__PURE__*/_jsxs(\"li\",{className:tabState===\"comments\"?\"active\":\"\",onClick:function onClick(){return setTabState(\"comments\");},children:[\"Comments (\",commentNum,\")\"]}),/*#__PURE__*/_jsx(\"li\",{className:tabState===\"related\"?\"active\":\"\",onClick:function onClick(){return setTabState(\"related\");},children:\"Related (3)\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-content \".concat(tabState===\"summary\"?\"show\":\"\"),children:/*#__PURE__*/_jsx(\"p\",{children:desc})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-content \".concat(tabState===\"comments\"?\"show\":\"\"),children:[/*#__PURE__*/_jsx(CommentBox,{replyNum:replyto,commentId:0}),comments.map(function(comment){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Comment,{comment:comment,level:0})});})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"leaderboard\",children:/*#__PURE__*/_jsx(\"img\",{src:leaderboard})})]})]});}export default GameDetails;","map":{"version":3,"names":["rating","leaderboard","React","useEffect","useRef","useNavigate","ToastContainer","toast","Slide","useParams","IsLoggedIn","logout","getCurrentUser","promptIco","closeIco","nestComments","commentList","commentMap","forEach","comment","id","parentId","parent","children","push","filter","GameDetails","useState","name","setName","desc","setDesc","author","setAuthor","players","setPlayers","views","setViews","cover","setCover","comments","setComments","commentNum","setCommentNum","tabState","setTabState","content","setContent","replyto","setReplyto","popupState","setPopupState","subject","setSubject","topics","setTopics","topic","setTopic","mountedRef","GetUser","uid","field","response","fetch","then","res","json","data","JSON","stringify","avatar","displayName","status","refreshPage","description","coverW","length","authorId","index","user","profileId","username","reverse","email","userId","roles","x","i","slice","toLowerCase","Comment","level","date","createdAt","split","time","text","parseInt","parse","paddingBottom","display","map","subChildren","SampleCmt","commentContent","addToBox","commentBox","document","getElementById","value","focus","CommentBox","replyNum","commentId","navigate","handleSubmit","current","addView","console","log","window","scrollTo","viewNum","method","headers","body","catch","error","submitComment","success","position","POSITION","BOTTOM_RIGHT","className","onClose","defaultValue","getTopics","submitSubject","e","submitTopic","width","target","topicOption","code"],"sources":["/Users/celia/Projects/Merakey/client/src/components/gameDetails.js"],"sourcesContent":["import \"../styles/gameDetails.scss\";\nimport rating from \"../images/rating.png\";\nimport leaderboard from \"../images/game-leaderboard.png\";\n// import cover from \"../images/whodidit.png\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { ToastContainer, toast, Slide } from \"react-toastify\";\nimport { useParams } from \"react-router-dom\";\nimport IsLoggedIn, { logout, getCurrentUser } from \"./utilities/loginStatus\";\n\n//icons\nimport promptIco from \"../images/login-prompt.svg\";\nimport closeIco from \"../images/close.svg\";\n\n// import { comments } from \"../../../api/app/models\";\n\nfunction nestComments(commentList) {\n  const commentMap = {};\n\n  // 先把 commentList 转为名为 commentMap 的 array（本来是个 list）\n  commentList.forEach((comment) => (commentMap[comment.id] = comment));\n\n  // iterate over the comments again and correctly nest the children\n  commentList.forEach((comment) => {\n    if (comment.parentId !== null) {\n      const parent = commentMap[comment.parentId];\n      // parent 就是这个数组里 id 评论 parentId 的那条评论\n      (parent.children = parent.children || []).push(comment);\n      // 上面这个等于 parent.children = parent.children ? parent.children : []\n      // 如果 parent 有 children 的 attribute，那就把这条 comment 整条 push 进去，如果没有，就创建这个 attribute 然后 push 进去\n    }\n  });\n\n  // 这个时候，所有子评论都被放到母评论里了，所有有 parentId 的都是母评论，子评论都被装在母评论里面了，漏在外面的子评论不用理会\n  // filter the list to return a list of correctly nested comments\n  return commentList.filter((comment) => {\n    return comment.parentId === null;\n  });\n}\n\nfunction GameDetails() {\n  const [name, setName] = React.useState(null);\n  const [desc, setDesc] = React.useState(null);\n  const [author, setAuthor] = React.useState(null);\n  const [players, setPlayers] = React.useState(null);\n  const [views, setViews] = React.useState(null);\n  const [cover, setCover] = React.useState(null);\n  const [comments, setComments] = React.useState([]);\n  const [commentNum, setCommentNum] = React.useState(0);\n  const [tabState, setTabState] = React.useState(\"summary\");\n  const [content, setContent] = React.useState(\"\");\n  const [replyto, setReplyto] = React.useState(0);\n  const [popupState, setPopupState] = React.useState(true);\n  const [subject, setSubject] = React.useState(\"null\");\n  const [topics, setTopics] = React.useState([\"null\"]);\n  const [topic, setTopic] = React.useState(\"null\");\n  const mountedRef = React.useRef(true); // ← the \"flag\"\n  const { id } = useParams();\n  // console.log(\"id: \" + id);\n  function GetUser(uid, field) {\n    const response = fetch(`http://localhost:8080/api/profiles/${uid}`)\n      .then((res) => res.json())\n      .then((data) => {\n        // console.log(\"data of user \" + uid + \": \" + JSON.stringify(data.avatar));\n        switch (field) {\n          case \"avatar\":\n            // console.log(\"#222 avatar\" + JSON.stringify(data.avatar));\n            return JSON.stringify(data.avatar);\n          case \"username\":\n            return data.displayName;\n          case \"status\":\n            return data.status;\n        }\n        return JSON.stringify(data.avatar);\n      });\n\n    // console.log(\"#333 response: \" + response);\n    return response;\n  }\n  const refreshPage = async () => {\n    fetch(`http://localhost:8080/api/games/${id}`)\n      .then((res) => res.json())\n      .then(async (data) => {\n        setName(data.name);\n        setDesc(data.description);\n        setPlayers(data.players);\n        setViews(data.views);\n        setCover(data.coverW);\n        setCommentNum(data.comments.length);\n        var author = await GetUser(data.authorId, \"username\");\n        setAuthor(author);\n        // console.log(\"comments: \" + JSON.stringify(nestComments(data.comments)));\n        var comments = data.comments;\n        for (let index = 0; index < comments.length; index++) {\n          var user = comments[index].profileId;\n          comments[index].avatar = await GetUser(user, \"avatar\");\n          comments[index].username = await GetUser(user, \"username\");\n          comments[index].status = await GetUser(user, \"status\");\n        }\n        setComments(nestComments(data.comments).reverse());\n      });\n  };\n\n  // const refreshPage = () => {\n  //   fetch(`http://localhost:8080/api/games/${id}`)\n  //     .then((res) => res.json())\n  //     .then(async (data) => {\n  //       var comments = data.comments;\n  //       for (let index = 0; index < comments.length; index++) {\n  //         var user = comments[index].profileId;\n  //         comments[index].avatar = await GetUser(user, \"avatar\");\n  //         comments[index].username = await GetUser(user, \"username\");\n  //         comments[index].status = await GetUser(user, \"status\");\n  //       }\n  //       setComments(comments);\n  //     });\n  // };\n\n  if (getCurrentUser) {\n    // console.log(getCurrentUser);\n    var username = getCurrentUser.username;\n    var email = getCurrentUser.email;\n    var userId = getCurrentUser.id;\n    var roles = [];\n    getCurrentUser.roles.forEach((x, i) =>\n      roles.push(x.slice(5).toLowerCase())\n    );\n    // console.log(roles);\n  }\n\n  function Comment({ comment, level }) {\n    // console.log(comment);\n    if (!level) {\n      var level = 0;\n    }\n    var user = comment.userId;\n    var date = comment.createdAt.split(\"T\")[0];\n    var time = comment.createdAt.split(\"T\")[1].split(\".\")[0];\n    var content = comment.text;\n    var author = parseInt(comment.profileId);\n    var avatar = GetUser(author, \"avatar\");\n    // console.log(\n    //   \"#444 author is: \" + author + \" avatar is: \" + avatar + typeof avatar\n    // );\n    var children = comment.children;\n    if (level == 0) {\n      // console.log(level);\n      return (\n        <div className=\"comment-block\" key={comment.id}>\n          <div className=\"comment-info\">\n            <div className=\"profile-container\">\n              {/* <img src=\"https://cdn.jsdelivr.net/gh/liangchuxin/blog-files/img/20210315225826.jpg\"></img> */}\n              <img src={JSON.parse(comment.avatar)}></img>\n\n              <span\n                className={`user-status ${comment.status}`}\n                title={`${comment.status}…`}\n              ></span>\n            </div>\n            <div className=\"username\">\n              <p>{comment.username}</p>\n            </div>\n            <div className=\"separator\"></div>\n            <div className=\"date\" title={time}>\n              {date}\n            </div>\n          </div>\n          <div className=\"comment-content\">\n            <p>{content}</p>\n          </div>\n          <div\n            className=\"reply-comment\"\n            style={replyto !== comment.id ? { paddingBottom: `40px` } : {}}\n          >\n            <div onClick={() => setReplyto(comment.id)}>Reply</div>\n            <div\n              onClick={() => setReplyto(0)}\n              style={replyto !== comment.id ? { display: `none` } : {}}\n            >\n              Cancel Reply\n            </div>\n          </div>\n          <CommentBox replyNum={replyto} commentId={comment.id} />\n          {children?.map((subChildren) => (\n            <Comment comment={subChildren} level={level + 1} />\n          ))}\n        </div>\n      );\n    } else {\n      return (\n        <div className=\"comment-block\" key={comment.id}>\n          <div className=\"comment-info\">\n            <div className=\"profile-container\">\n              {/* <img src=\"https://cdn.jsdelivr.net/gh/liangchuxin/blog-files/img/20210315225826.jpg\"></img> */}\n              <img src={JSON.parse(comment.avatar)}></img>\n              <span\n                className={`user-status ${comment.status}`}\n                title={`${comment.status}…`}\n              ></span>{\" \"}\n            </div>\n            <div className=\"username\">\n              <p>{comment.username}</p>\n            </div>\n            <div className=\"separator\"></div>\n            <div className=\"date\" title={time}>\n              {date}\n            </div>\n          </div>\n          <div className=\"comment-content\">\n            <p>{content}</p>\n          </div>\n          <div\n            className=\"reply-comment\"\n            style={replyto !== comment.id ? { paddingBottom: `40px` } : {}}\n          >\n            <div onClick={() => setReplyto(comment.id)}>Reply</div>\n            <div\n              onClick={() => setReplyto(0)}\n              style={replyto !== comment.id ? { display: `none` } : {}}\n            >\n              Cancel Reply\n            </div>\n          </div>\n          <CommentBox replyNum={replyto} commentId={comment.id} />\n          {children?.map((subChildren) => (\n            <Comment comment={subChildren} level={level + 1} />\n          ))}\n        </div>\n      );\n    }\n  }\n\n  function SampleCmt({ commentContent }) {\n    const addToBox = (commentContent) => {\n      var commentBox = document.getElementById(\"comment-box\");\n      commentBox.value += commentContent + \" \";\n      // setContent(commentBox.value);\n      // console.log(\"Content in the box: \" + content);\n      commentBox.focus();\n    };\n    return (\n      <span onClick={() => addToBox(commentContent)}>{commentContent}</span>\n    );\n  }\n  React.useEffect(() => {\n    refreshPage();\n  }, []);\n  function CommentBox({ replyNum, commentId }) {\n    // console.log(\"content: \" + document.getElementById(\"comment-box\").value);\n    // var originalValue = document.getElementById(\"comment-box\").value;\n\n    if (replyNum == commentId) {\n      if (!IsLoggedIn()) {\n        return (\n          <>\n            <div className=\"comment-box\">\n              <p>\n                Please <span onClick={() => navigate(\"/signup\")}>sign up</span>{\" \"}\n                or <span onClick={() => navigate(\"/login\")}>login</span> to\n                comment!\n              </p>\n            </div>\n          </>\n        );\n      } else {\n        return (\n          <>\n            <div className=\"comment-box\">\n              <textarea\n                placeholder={\n                  commentId === 0\n                    ? `Please input a friendly comment…`\n                    : `Reply to…`\n                }\n                id=\"comment-box\"\n                // onChange={(event) => setContent(event.target.value)}\n                // defaultValue={document.getElementById(\"comment-box\").value}\n              ></textarea>\n              <div className=\"submit-btn\" onClick={() => handleSubmit()}>\n                Submit\n              </div>\n            </div>\n            <div\n              className=\"sample-comments\"\n              style={\n                commentId === 0\n                  ? { paddingBottom: \"55px\" }\n                  : { paddingBottom: \"40px\" }\n              }\n            >\n              <SampleCmt commentContent=\"Nice game!\" />\n              <SampleCmt commentContent=\"Wonderful experience!\" />\n            </div>\n          </>\n        );\n      }\n    } else {\n      return null;\n    }\n  }\n  React.useEffect(() => {\n    if (mountedRef.current) {\n      mountedRef.current = false;\n    } else {\n      addView(views + 1);\n      console.log(\"there are \" + views + \" views\");\n    }\n  }, [views]);\n  React.useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  // console.log(name, desc);\n\n  const navigate = useNavigate();\n\n  const addView = (viewNum) => {\n    const data = { views: viewNum };\n    fetch(`http://localhost:8080/api/games/${id}`, {\n      method: \"PUT\", // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"Success:\", data);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const submitComment = (comment, parent, user) => {\n    const data = { text: comment, parentId: parent, userId: user };\n    fetch(`http://localhost:8080/api/comments/${id}`, {\n      method: \"POST\", // or 'PUT'\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(\"Success:\", data);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const handleSubmit = () => {\n    var content = document.getElementById(\"comment-box\").value;\n    console.log(\"Submit comment: \" + content);\n    if (replyto == 0) {\n      submitComment(content, null, userId);\n    } else {\n      submitComment(content, replyto, userId);\n    }\n    toast.success(\"Your comment is submitted!\", {\n      position: toast.POSITION.BOTTOM_RIGHT,\n      className: \"foo-bar\",\n      onClose: () => {\n        content = \"\";\n        document.getElementById(\"comment-box\").defaultValue = \"\";\n        refreshPage();\n      },\n    });\n  };\n  const getTopics = (subject) => {\n    fetch(`http://localhost:8080/api/topics/subject/${subject}`)\n      .then((response) => response.json())\n      .then((data) => {\n        setTopics(data);\n      })\n      .catch((error) => {\n        console.error(\"Error:\", error);\n      });\n  };\n  const submitSubject = (e) => {\n    setSubject(e);\n    setTopic(\"null\");\n    getTopics(e);\n  };\n  const submitTopic = (e) => {\n    setTopic(e);\n  };\n  console.log(\"topic: \" + topic);\n\n  return (\n    <>\n      {!IsLoggedIn() && popupState && (\n        <div className=\"login-popup\">\n          <img src={promptIco} />\n\n          <div className=\"title\">Login to see your progress!</div>\n          <div className=\"content\">\n            Login or sign up to comment, view all your practice / game\n            histories, and to track the wrong questions!\n          </div>\n          <div className=\"btn-container\">\n            <div className=\"signup\" onClick={() => navigate(\"/signup\")}>\n              Sign up\n            </div>\n            <div className=\"next\" onClick={() => setPopupState(false)}>\n              Next time\n            </div>\n          </div>\n          <div className=\"close\" onClick={() => setPopupState(false)}>\n            <img src={closeIco} />\n          </div>\n        </div>\n      )}\n      <div className=\"details-page\">\n        <div className=\"details\">\n          <ToastContainer autoClose={1000} theme=\"dark\" transition={Slide} />\n          <div className=\"cover-container\">\n            <img src={cover} style={{ width: \"772px\" }} />\n          </div>\n          <div className=\"game-details\">\n            <h3>{name}</h3>\n            <div className=\"info\">\n              <p className=\"author\">By @{author}</p>\n              <div className=\"rating\">\n                <img src={rating} />\n              </div>\n            </div>\n            <p className=\"played\">Played by: {players} players</p>\n          </div>\n          <div className=\"start-options\">\n            <button\n              className={`start-btn${topic == \"null\" ? \" disabled\" : \"\"}`}\n              onClick={() => navigate(`play/${topic}`)}\n              disabled={topic == \"null\" ? true : false}\n            >\n              Start Game\n            </button>\n            <select\n              id=\"subject\"\n              name=\"subject\"\n              className=\"subject-dropdown\"\n              onChange={(e) => submitSubject(e.target.value)}\n            >\n              <option value=\"null\" selected={subject === \"null\"}>\n                Choose Subject\n              </option>\n              <option value=\"maths\" selected={subject == \"maths\"}>\n                Maths\n              </option>\n              <option value=\"physics\" selected={subject == \"physics\"}>\n                Physics\n              </option>\n            </select>\n            {JSON.stringify(topics) !== '[\"null\"]' && (\n              <>\n                <select\n                  id=\"topic\"\n                  name=\"topic\"\n                  className=\"topic-dropdown\"\n                  onChange={(e) => submitTopic(e.target.value)}\n                >\n                  <option value=\"none\">Choose Topic</option>\n                  <option value=\"all\">All Topics</option>\n                  {topics.map((topicOption, index) => (\n                    <option value={topicOption.id}>\n                      {index + 1}. {topicOption.code} {topicOption.name}\n                    </option>\n                  ))}\n                </select>\n              </>\n            )}\n          </div>\n\n          <br />\n          <div className=\"tabs\">\n            <ul>\n              <li\n                className={tabState === \"summary\" ? \"active\" : \"\"}\n                onClick={() => setTabState(\"summary\")}\n              >\n                Summary\n              </li>\n              <li\n                className={tabState === \"comments\" ? \"active\" : \"\"}\n                onClick={() => setTabState(\"comments\")}\n              >\n                Comments ({commentNum})\n              </li>\n              <li\n                className={tabState === \"related\" ? \"active\" : \"\"}\n                onClick={() => setTabState(\"related\")}\n              >\n                Related (3)\n              </li>\n            </ul>\n          </div>\n          <div\n            className={`tab-content ${tabState === \"summary\" ? \"show\" : \"\"}`}\n          >\n            <p>{desc}</p>\n          </div>\n          <div\n            className={`tab-content ${tabState === \"comments\" ? \"show\" : \"\"}`}\n          >\n            <CommentBox replyNum={replyto} commentId={0} />\n\n            {comments.map((comment) => (\n              <>\n                <Comment comment={comment} level={0} />\n              </>\n            ))}\n          </div>\n        </div>\n        <div className=\"leaderboard\">\n          <img src={leaderboard} />\n        </div>\n      </div>\n    </>\n  );\n}\nexport default GameDetails;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}